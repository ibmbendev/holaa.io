<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Hello socket world</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="bower_components/angular-material/angular-material.min.css" rel="stylesheet">
	<link href="/css/build/main.css" rel="stylesheet">
</head>
<body ng-app="app">

	<div ng-controller="appController" layout="column" class="main-content">
		<md-toolbar class="md-primary app-toolbar" layout="row" layout-wrap>
			<h1 class="md-toolbar-tools" flex>
				<span ng-show="!userReadyToChat"> Join the conversation</span>
				<span ng-show="userReadyToChat"> {{channel}} </span>
			</h1>
			<div flex></div>
			
			<md-button ng-click="toggleChannelInformation()" ng-show="userReadyToChat && users.length > 1" class="action">
				<span class="entypo-user"></span> {{users.length}}
			</md-button>
			<md-button ng-show="userReadyToChat" class="action" ng-click="logout()"><span class="entypo-logout"></span></md-button>
			</h5>
		</md-toolbar>

		<div layout="column" flex layout-align="center center" ng-show="!userReadyToChat">
			<div layout="column" layout-align="center">
				<md-content layout-padding layout-align="center">
					<h3> Start a conversation with the world </h3>
					<form name="userForm" ng-submit="login()" >
						<div layout="column" flex>
							<div flex>
								<md-input-container>
									<label>Full name</label>
									<input required ng-model="user.fullName">
								</md-input-container>
							</div>
							<div flex layout="row">
								<md-input-container flex>
									<label>Channel</label>
									<input ng-model="channel" ng-blur="fixChannelName(channel, true)" ng-keyup="fixChannelName(channel, false)">
								</md-input-container>
								<md-button class=" md-fab md-accent ">Enter</md-button>
							</div>
						</div>
					</form>
				</md-content>
			</div>
		</div>
	

		<div class="chat-room-container" layout="row" flex ng-show="userReadyToChat" >
			<div layout="column" flex class="chat-room" flex layout-align="space-between start">
				<div flex class="fade chat-message-container" md-scroll-y>
					<div class="message-block" ng-repeat="message in messages" flex layout="column">
						<div ng-if="message.type=='user'">
							<a flex class="author" style="color: {{message.user.color}}">{{message.user.fullName}} <i class="timestamp">{{message.timestamp | date:'h:mma'}}</i></a>
							<div flex class="message-container">
								{{message.message}}
							</div>
						</div>
						<div ng-if="message.type=='bot'">
							<h5 ng-bind-html="message.message | basicHtmlFilter"></h5>
						</div>
					</div>
					<h5 class="message-block user-alone" ng-show="users.length == 1"> There is nobody apart from you in this channel</h5>
					<div id="bottom"></div>
				</div>
				<form name="messageForm" ng-submit="submitMessage()"layout="row" class="chat-input-container">
					<h5 class="author" ng-attr-title="{{user.fullName}}">
						{{user.fullName.length >= 10 ? user.fullName.substr(0, 10) + '...' : user.fullName}}:
					</h5>
					<md-input-container flex md-no-float>
						<input type="text" required placeholder="Write a message. Press Enter to send." ng-model="message">
					</md-input-container>
					<md-button class="md-raised md-accent ">Enter</md-button>
				</form>
			</div>

			<md-sidenav flex class="md-sidenav-right md-whiteframe-z3" md-is-locked-open="$mdMedia('gt-sm')" ng-show="userReadyToChat" md-component-id="active-users">
				<md-content layout-padding>
					<h1 layout-padding> Online users ({{users.length}})</h1>
					<ul layout-padding>
						<li ng-repeat="user in users"> <span class="entypo-right-open"></span><span style="color: {{user.color}}">{{user.fullName}}</span></li>
					</ul>
				</md-content>
			</md-sidenav>

		</div>

	</div>

	
	<script src="/bower_components/lodash/lodash.min.js"></script>
	<script src="/bower_components/angular/angular.min.js"></script>
	<script src="/bower_components/angular-ui-router/release/angular-ui-router.min.js"></script>

	<script src="/bower_components/angular-aria/angular-aria.min.js"></script>
	<script src="/bower_components/angular-animate/angular-animate.min.js"></script>
	<script src="/bower_components/angular-material/angular-material.min.js"></script>
	<script src="/bower_components/socket.io-client/socket.io.js"></script>


	<!-- <script src="/bower_components/angular-resource/angular-resource.min.js"></script> -->

	<script src="/js/build/main.js"></script>
</body>
</html>